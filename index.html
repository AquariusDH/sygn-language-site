<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sygn Language — Zodiac Translator</title>
  <meta name="description" content="Translate your message for any zodiac sign’s style. Join the waitlist to get the app first." />
  <meta name="theme-color" content="#0b0b0b" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0b0b0b; --card:#141414; --muted:#9aa0a6; --brand:#3A86FF; --text:#fff; --border:#2a2a2a; }
    * { box-sizing: border-box; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    a { color: var(--brand); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .container { max-width: 880px; margin: 0 auto; padding: 24px; }
    .hero { text-align: center; margin: 24px 0 16px; }
    .h1 { font-weight: 800; font-size: clamp(28px, 3.5vw, 36px); letter-spacing: -0.02em; }
    .sub { color: var(--muted); margin-top: 6px; font-size: 15px; }
    .note { margin-top: 10px; color: var(--muted); font-size: 14px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
    .stack { display: grid; gap: 12px; }
    label { font-size: 13px; color: #d6d6d6; }
    select, textarea, input[type="email"] {
      width: 100%; background: #0f0f0f; color: var(--text); border: 1px solid var(--border);
      border-radius: 10px; padding: 10px 12px; font-size: 14px; outline: none;
    }
    textarea { min-height: 110px; resize: vertical; }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; }
    .btn { background: var(--brand); color: #000; font-weight: 700; border: 0; border-radius: 10px; padding: 12px 14px; cursor: pointer; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .out { white-space: pre-wrap; background:#0f0f0f; border: 1px solid var(--border); padding: 12px; border-radius: 10px; font-size: 14px; }
    .muted { color: var(--muted); }
    footer { margin: 28px 0 16px; text-align: center; color: var(--muted); font-size: 13px; }
    .grid { display: grid; gap: 16px; grid-template-columns: 1fr; }
    @media (min-width: 880px){ .grid { grid-template-columns: 2fr 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <div class="h1">Sygn Language — Zodiac Translator</div>
      <p class="sub">Rewrite your message for how their sign actually hears it.</p>
      <p class="note">App coming soon — join the waitlist below to be first to know.</p>
    </header>

    <main class="grid">
      <!-- Translator -->
      <section class="card">
        <h2 style="margin:0 0 12px; font-size:18px;">Translate a message</h2>
        <div class="stack">
          <div class="row">
            <div>
              <label for="you">Your sign</label>
              <select id="you">
                <option value="Aries">Aries</option><option value="Taurus">Taurus</option>
                <option value="Gemini">Gemini</option><option value="Cancer">Cancer</option>
                <option value="Leo">Leo</option><option value="Virgo">Virgo</option>
                <option value="Libra">Libra</option><option value="Scorpio">Scorpio</option>
                <option value="Sagittarius">Sagittarius</option><option value="Capricorn">Capricorn</option>
                <option value="Aquarius">Aquarius</option><option value="Pisces">Pisces</option>
              </select>
            </div>
            <div>
              <label for="them">Their sign</label>
              <select id="them">
                <option value="Aries">Aries</option><option value="Taurus">Taurus</option>
                <option value="Gemini">Gemini</option><option value="Cancer">Cancer</option>
                <option value="Leo">Leo</option><option value="Virgo">Virgo</option>
                <option value="Libra">Libra</option><option value="Scorpio">Scorpio</option>
                <option value="Sagittarius">Sagittarius</option><option value="Capricorn">Capricorn</option>
                <option value="Aquarius">Aquarius</option><option value="Pisces">Pisces</option>
              </select>
            </div>
          </div>

          <div>
            <label for="msg">Your message</label>
            <textarea id="msg" placeholder="Type what you want to say…"></textarea>
          </div>

          <button id="translate" class="btn">Translate</button>

          <div>
            <div class="muted" style="font-size:13px; margin-bottom:6px;">Suggested tone</div>
            <div id="tone" class="out">—</div>
          </div>

          <div>
            <div class="muted" style="font-size:13px; margin-bottom:6px;">Rewritten message</div>
            <div id="output" class="out">—</div>
          </div>
        </div>
      </section>

      <!-- Waitlist -->
      <aside class="card">
        <h2 style="margin:0 0 12px; font-size:18px;">Get the app first</h2>
        <p class="muted" style="margin-top:-6px;">Join the waitlist and we’ll email you when it launches.</p>
        <form id="waitlist" class="stack" novalidate>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="you@email.com" required />
          </div>
          <label style="display:flex; gap:8px; align-items:flex-start; font-size:13px; color:#d6d6d6;">
            <input type="checkbox" id="consent" required />
            <span>I agree to receive product updates. Unsubscribe anytime.</span>
          </label>
          <button class="btn" id="join">Join waitlist</button>
          <div id="form-status" class="muted" role="status" aria-live="polite"></div>
        </form>
      </aside>
    </main>

    <footer>
      © <span id="year"></span> Sygn Language ·
      <a href="/terms">Terms</a> · <a href="/privacy">Privacy</a>
    </footer>
  </div>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Smarter translator with variety & intent detection =====
    const tones = {
      Aries: "Direct, bold, solution-first.",
      Taurus: "Steady, specific, show reliability.",
      Gemini: "Playful, curious—invite a quick reply.",
      Cancer: "Warm, reassuring—name the feeling.",
      Leo: "Confident, appreciative—add a little hype.",
      Virgo: "Clear, structured, no ambiguity.",
      Libra: "Balanced, considerate—offer two options.",
      Scorpio: "Intentional, honest—no fluff.",
      Sagittarius: "Upbeat, spontaneous—keep it light.",
      Capricorn: "Respectful of time—clear next steps.",
      Aquarius: "Thoughtful, original—explain the why.",
      Pisces: "Gentle, empathetic—soft edges."
    };

    const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const clean = (s) => (s || "").trim().replace(/\s+/g, " ");

    function detectIntent(text) {
      const t = (text || "").toLowerCase();
      if (/(sorry|apologiz|my bad|i was wrong)/.test(t)) return "apology";
      if (/(can'?t|cannot|busy|overwhelmed|need space|boundary)/.test(t)) return "boundary";
      if (/(hang|dinner|coffee|see you|plan|movie|tonight|tomorrow|\bwhen\b|\bwhat time\b|\bwhere\b|\bdate\b|\bmeet\b)/.test(t)) return "plan";
      if (/(miss you|thinking of you|appreciate|grateful|care about|love|fond)/.test(t)) return "affection";
      return "general";
    }

    const bits = {
      openers: {
        direct: ["Real talk:", "Quick check-in:", "Heads up:", "FYI:"],
        warm: ["Hey—", "Hi :)", "Just sharing—", "Wanted to say—"],
        playful: ["Hear me out—", "Tiny idea—", "Wild thought—", "Low-stakes pitch—"],
      },
      closers: {
        invite: ["Thoughts?", "Works for you?", "Down?", "Open to it?"],
        affirm: ["Appreciate you.", "Thanks for reading.", "I value this.", "All good either way."],
        plan: ["I can lock it in.", "I’ll set it up.", "I’ll book it.", "I’ll handle details."]
      }
    };

    const styles = {
      Aries:   { opener: "direct", cadence: "short",   asks: ["Let’s decide now.", "Pick one and go."], soften:false },
      Taurus:  { opener: "warm",   cadence: "grounded",asks: ["I’ll handle it.", "Keeping it simple."], soften:true },
      Gemini:  { opener: "playful",cadence: "bouncy",  asks: ["Thoughts?", "What’s your take?"], soften:false },
      Cancer:  { opener: "warm",   cadence: "soft",    asks: ["How does that feel?", "Okay with you?"], soften:true },
      Leo:     { opener: "warm",   cadence: "confident",asks:["Let’s make it fun.", "You in?"], soften:false },
      Virgo:   { opener: "direct", cadence: "ordered", asks: ["Confirm?", "Good with details?"], soften:false },
      Libra:   { opener: "warm",   cadence: "balanced",asks: ["A or B?", "Which vibe fits?"], soften:true },
      Scorpio: { opener: "direct", cadence: "intense", asks: ["Honest take?", "Are you aligned?"], soften:false },
      Sagittarius:{opener:"playful",cadence:"upbeat",  asks:["Up for it?", "Say yes, we go."], soften:false },
      Capricorn:{ opener: "direct", cadence: "crisp",  asks: ["Confirm time?", "Does this work?"], soften:false },
      Aquarius:{ opener: "direct", cadence: "reasoned",asks: ["Make sense?", "On board?"], soften:false },
      Pisces:  { opener: "warm",   cadence: "soft",    asks: ["Does this resonate?", "Feel okay?"], soften:true }
    };

    function templates(intent, signStyle, raw) {
      const opener = pick(bits.openers[signStyle.opener]);
      const closerInvite = pick(bits.closers.invite);
      const closerAffirm = pick(bits.closers.affirm);
      const closerPlan   = pick(bits.closers.plan);
      const ask = pick(signStyle.asks);

      switch (intent) {
        case "apology":
          return [
            `${opener} I missed the mark earlier. ${raw || "That wasn’t fair."} I’m fixing it. ${ask}`,
            `${opener} You’re right—${raw || "I didn’t handle that well."} I’ll do better next round. ${closerAffirm}`
          ];
        case "boundary":
          return [
            `${opener} I need a little space to reset. ${raw || "Can we pick this up later?"} ${signStyle.soften ? "I appreciate your patience. " : ""}${closerAffirm}`,
            `${opener} Today’s packed on my end. ${raw || "Let’s regroup tomorrow."} ${closerInvite}`
          ];
        case "plan":
          return [
            `${opener} ${raw || "Dinner this week?"} ${signStyle.opener === "warm" ? "Low-key works." : "Let’s keep it simple."} ${closerPlan}`,
            `${opener} ${raw || "Movie or tacos?"} I can do 7 or 8. ${ask}`
          ];
        case "affection":
          return [
            `${opener} ${raw || "Thinking of you."} Wanted you to know I appreciate you. ${closerAffirm}`,
            `${opener} ${raw || "You matter to me."} Hope that lands how I mean it. ${closerInvite}`
          ];
        default:
          return [
            `${opener} ${raw || "Quick thought."} ${ask}`,
            `${opener} ${raw || "Small update."} ${closerAffirm}`
          ];
      }
    }

    function rewriteFor(sign, text) {
      const msg = clean(text);
      const intent = detectIntent(msg);
      const style = styles[sign] || styles.Aquarius;

      let raw = msg || "";
      if (style.cadence === "short") raw = raw.replace(/\,/g, " ").replace(/\band\b/gi, "&");
      if (style.cadence === "ordered") {
        raw = raw.replace(/\s+/g, " ").trim();
        if (raw && !/[:.]$/.test(raw)) raw += ".";
      }
      if (style.soften && raw) raw = raw + " If that’s cool.";

      const candidates = templates(intent, style, raw);
      const chosen = pick(candidates);
      return { tone: tones[sign] || "—", text: chosen };
    }

    document.getElementById('translate').addEventListener('click', () => {
      const them = document.getElementById('them').value;
      const msg = document.getElementById('msg').value;

      const { tone, text } = rewriteFor(them, msg);
      document.getElementById('tone').textContent = tone;

      // Show 2 fresh variants each click for variety
      const alt = rewriteFor(them, msg).text;
      document.getElementById('output').textContent = `• ${text}\n• ${alt}`;
    });

    // ===== Waitlist form -> /api/signup =====
    const form = document.getElementById('waitlist');
    const statusEl = document.getElementById('form-status');
    const joinBtn = document.getElementById('join');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      joinBtn.disabled = true; joinBtn.textContent = "Sending…";

      const email = document.getElementById('email').value.trim();
      const consent = document.getElementById('consent').checked;

      if (!email || !consent) {
        statusEl.textContent = "Please enter a valid email and agree to updates.";
        joinBtn.disabled = false; joinBtn.textContent = "Join waitlist";
        return;
      }

      try {
        const res = await fetch('/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, reward: 'waitlist' })
        });
        if (res.ok) {
          statusEl.textContent = "✅ Thanks! Check your inbox.";
          form.reset();
        } else {
          const j = await res.json().catch(()=>({}));
          statusEl.textContent = "❌ Could not send email. Try again.";
          console.error('Signup error', j);
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = "❌ Network error. Try again.";
      } finally {
        joinBtn.disabled = false; joinBtn.textContent = "Join waitlist";
      }
    });
  </script>
</body>
</html>
